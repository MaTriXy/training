<!DOCTYPE html>
<html>
  <head>
    <title>Android training - app in a day</title>
    <meta charset='utf-8'>
    <script src='../res/slides.js'></script>
  </head>
  <body style='display: none'>
    <section class='slides layout-regular template-default'>
    
<article>
<!-- ==================================================== -->

<h1>app in a day</h1>  
   
<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Exercise 1</h3>
<ul>
  <li>Create a new project with one activity DashboardActivity</li>
  <li>Run it</li>
</ul>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 1</h3>
<ul>
  <li>Create a new android project and follow the instruction</li>
  <li>Create adv if you don't have an android device</li>
  <li>Deploy the app and run it</li>
</ul> 
   
<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Exercise 2</h3>
<ul>
  <li>Change layout of DashboardActivity activity</li>
  <li>Add a Button with a text "Search"</li>
  <li>Add an EditText</li>
  <li>Set a onClickListener in the Button</li>
  <li>Log the text of the EditText when the button is pressed</li>
</ul>
   
<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 2</h3>
<ul>
  <li>In main layout add EditText with id keyword</li>
  <li>In main layout add Button with id submit</li>
  <li>Change the string to search</li>
  <li>Add the click listener in the DashboardActivity and log the content of keyword</li>
</ul>
<pre><code>final EditText editText = (EditText)findViewById(R.id.keyword);
  Button submit = (Button)findViewById(R.id.submitsearch);
  submit.setOnClickListener(new OnClickListener() {
  public void onClick(View v) {
    Log.v("AppInADay", "keyword to search for is : " 
      + editText.getText().toString());
  }
});
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Exercise 3</h3>
<ul>
  <li>Add new activity SearchResultActivity</li>
  <li>On search submit move from DashboardActivity to SearchResultActivity</li>
  <li>Pass the value contained in the EditText to the SearchResultActivity</li>
  <li>Show the keyword in a TextView in the SearchResultActivity</li>
</ul>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 3</h3>
<ul>
  <li>Create new class SearchResultActivity</li>
  <li>Add in the manifest the declaration of the new activity</li>
  <li>Rename main.xml to dashboard_activity.xml</li>
  <li>Copy dashboard_activity.xml as search_result_activity.xml</li>
  <li>Edit the layout to have an TextView</li>
  <li>In the on click listener of the DashboardActivity add the following code</li>
</ul>
<pre><code>Intent i = new Intent(getApplicationContext(), 
  SearchResultActivity.class);
i.putExtra("keyword", editText.getText().toString());
startActivity(i);</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 3</h3>
<ul>   
   <li>Finally onCreate of the SearchResultActivity add :</li>
</ul>
<pre><code>TextView keywordView = (TextView)findViewById(R.id.keyword);
String keyword = getIntent().getStringExtra("keyword");
keywordView.setText(keyword);</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Exercise 4</h3>
<ul>   
   <li>Transform the SearchResultActivity in a ListActivity</li>
   <li>Load the list from a simple List of strings</li>
</ul>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 4</h3>
<ul>   
   <li>Extend ListActivity instead of Activity</li>
   <li>Remove the code in onCreate</li>
   <li>Set the adapter with some data</li>
</ul>
<pre><code>List values = Arrays.asList("item 1","item 2","item 3");
ArrayAdapter adapter = new ArrayAdapter(this,
R.layout.search_result_item, R.id.title, values);
setListAdapter(adapter);</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 4</h3>
<ul>   
   <li>Modify search_result_activity.xml layout with ListView and id = @+android:id/list</li>
   <li>Create the search_result_item.xml</li>
</ul>
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android=
    "http://schemas.android.com/apk/res/android"
  android:layout_width="fill_parent"
  android:layout_height="fill_parent" &gt;
  &lt;TextView
    android:id="@+id/title"
    android:gravity="center"
    android:layout_width="fill_parent"
    android:layout_height="40dp" &gt;
  &lt;/TextView&gt;
&lt;/LinearLayout&gt;
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Exercise 5</h3>
<ul>   
   <li>Create a content provider</li>
   <li>Add some log in the implementation of crud operations</li>
   <li>Call query from the SearchResultActivity</li>
</ul>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 5</h3>
<ul>   
   <li>Create a class that extends ContentProvider</li>
   <li>Implements all the methods necessary</li>
</ul>
<pre><code>private static final String TAG = "AppInAday";
@Override
public int delete(Uri arg0, String arg1, String[] arg2) {
  Log.v(TAG, "delete");
  return 0;
}
@Override
public String getType(Uri uri) {
  Log.v(TAG, "type");
  return null;
}
@Override
public Uri insert(Uri uri, ContentValues values) {
  Log.v(TAG, "insert");
return null;
}</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 5</h3>
<pre><code>@Override
  public boolean onCreate() {
  Log.v(TAG, "onCreate");
  return false;
}
@Override
public Cursor query(Uri uri, String[] projection, String selection,
    String[] selectionArgs, String sortOrder) {
  Log.v(TAG, "query");
  return null;
}
@Override
public int update(Uri uri, ContentValues values, String selection,
    String[] selectionArgs) {
  Log.v(TAG, "update");
  return 0;
}</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 5</h3>
<ul>   
   <li>Declare the provider in the manifest</li>
</ul>
<pre><code>&lt;provider android:name=".SearchResultProvider" 
android:authorities="com.novoda.traning.appinaday" /&gt;
</code></pre>
<ul>   
   <li>Make a query in the SearchResultActivity</li>
</ul>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Exercise 6</h3>
<ul>   
   <li>Add a database</li>
   <li>Implement insert, delete and query</li>
   <li>Put some fixture data in the database</li>
   <li>Log the query in the SearchResultActivity</li>
</ul>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 6</h3>
<ul>   
  <li>Create a new class DatabaseHelper and extend SQLiteOpenHelper</li>
  <li>Set a database and version</li>
</ul>
<pre><code>private static final String DATABASE_NAME = "appinaday.db";
private static final int DATABASE_VERSION = 1;
  
public DatabaseHelper(Context context) {
  super(context, DATABASE_NAME, null, DATABASE_VERSION);
}</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 6</h3>
<ul>   
  <li>Implement the onCreate method and create the table and import some data</li>
</ul>
<pre><code>db.execSQL("CREATE TABLE results 
  (_id INTEGER PRIMARY KEY AUTOINCREMENT, title TEXT)");
db.execSQL("INSERT INTO results (title) VALUES (\"title 1\")");
db.execSQL("INSERT INTO results (title) VALUES (\"title 2\")");
db.execSQL("INSERT INTO results (title) VALUES (\"title 3\")");
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 6</h3>
<ul>   
  <li>Add implementation of query to the content provider</li>
</ul>
<pre><code>private DatabaseHelper databaseHelper;
@Override
public boolean onCreate() {
  databaseHelper = new DatabaseHelper(getContext());
  return false;
}
@Override
public Cursor query(Uri uri, String[] projection, String selection, 
    String[] selectionArgs, String sortOrder) {
  return databaseHelper.getReadableDatabase().query("results", 
      projection, selection, selectionArgs, null, null, sortOrder); 
}
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 6</h3>
<ul>   
  <li>Use the cursor to provide results in the SearchResultActivity</li>
</ul>
<pre><code>Uri uri = Uri.parse(
  "content://com.novoda.traning.appinaday/results");
Cursor c = getContentResolver().query(uri, null, null, null, null);
List&lt;String&gt; values = new ArrayList&lt;String&gt;();
while (c.moveToNext()){
	values.add(c.getString(c.getColumnIndex("title")));
}
c.close();
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 6 - Notes</h3>
<ul>   
  <li>CursorAdapter instead of ArrayAdapter</li>
</ul>

<!-- ==================================================== -->
</article>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Exercise 7</h3>
<ul>   
   <li>Create an IntentService and run it before calling on search submit</li>
   <li>Load the results in the list activity only when the service send back broadcast</li>
</ul>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 7</h3>
<ul>   
  <li>Create a new class and extend SearchService</li>
  <li>Add constructors and log the keyword</li>
</ul>
<pre><code>public SearchService() {
  this("SearchService");
}
public SearchService(String name) {
  super(name);
}
@Override
protected void onHandleIntent(Intent intent) {
  String keyword = intent.getStringExtra("keyword");
  if (TextUtils.isEmpty(keyword)) {
    return;
  }  
  Log.v("AppInADay", "Search for : " + keyword);    
}
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 7</h3>
<ul>   
  <li>Declare the service in the manifest</li>
</ul>
<pre><code>&lt;service android:exported="true" android:name=".SearchService"&gt;
  &lt;intent-filter&gt;
    &lt;action android:name="com.novoda.traning.appinaday.Search"/&gt;
  &lt;/intent-filter&gt;
&lt;/service&gt;
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 7</h3>
<ul>   
  <li>Add startService in the onResume of SearchResultActivity</li>
  <li>Run and check the logs</li>
</ul>
<pre><code>Intent i = new Intent(SearchService.ACTION);
i.putExtra("keyword", editText.getText().toString());
startService(i);
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 7</h3>
<ul>   
  <li>Send the broadcast from the service to inform the activity that the service has finished</li>
</ul>
<pre><code>sendBroadcast(intent);</code></pre>
<ul>   
  <li>Create a broadcast receiver in the SearchResultActivity</li>
</ul>
<pre><code>private BroadcastReceiver serchCompletedReceiver 
    = new BroadcastReceiver() {
  @Override
  public void onReceive(Context paramContext, Intent paramIntent) {
    Log.v("AppInADay", "onReceiver ");
  }
};</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 7</h3>
<ul>   
  <li>Register the receiver in the SearchResultActivity</li>
</ul>
<pre><code>@Override
protected void onResume() {
  super.onResume();
  registerReceiver(serchCompletedReceiver,
	SearchService.SEARCH_END_FILTER);
  
  //...start the service
}

@Override
protected void onPause() {
  unregisterReceiver(serchCompletedReceiver);
  super.onPause();
}
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Solution 7</h3>
<ul>  
  <li>Extract the and update method from the code of onCreate</li> 
  <li>Update the list content from the receiver</li>
</ul>
<pre><code>private BroadcastReceiver serchCompletedReceiver = new BroadcastReceiver() {
  @Override
  public void onReceive(Context paramContext, Intent paramIntent) {
  	Log.v("AppInADay", "onReceiver ");
  	update();
  }
};

@Override
protected void onPause() {
  unregisterReceiver(serchCompletedReceiver);
  super.onPause();
}
</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->

<h3>Exercise 8</h3>
<ul>   
   <li>Execute http call to get the result</li>
   <li>insert the list of the content in the database</li>
</ul>

<!-- ==================================================== -->
</article>

    </section>
  </body>
</html>