<!DOCTYPE html>
<html>
  <head>
    <title>Android training - Loaders</title>
    <meta charset='utf-8'>
    <script src='../res/slides.js'></script>
  </head>
  <body style='display: none'>
    <section class='slides layout-regular template-default'>
    
<article>
<!-- ==================================================== -->

<h1>Loaders</h1>
  
<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->
<h3>Quick overview</h3>
<ul>
  <li>Introduced in 3.0 (honeycomb)</li>
  <br>
  <li>Also available for previous SDKs in the support library</li>
  <br>
  <li>Available to every activity and fragment</li>
  <br>
  <li>Provide asynchronous loading of data</li>
  <br>
  <li>Able to monitor source and deliver new result when content changes</li>
</ul>


<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->
<h3>Main components</h3>
<ul>
  <li>LoaderManager - only one instance per activity or fragment</li>
  <br>
  <li>LoaderManager.LoaderCallbacks - callback interface to interact with loaders</li>
  <br>
  <li>Loader - abstract base class that defines the loader protocol</li>
  <br>
  <li>AsyncTaskLoader - child of loader which relies on ModernAsyncTask to perform the work</li>
  <br>
  <li>CursorLoader - child of AsyncTaskLoader - the de facto way of loading data from a ContentProvider</li>
</ul>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->
<h3>LoaderCallbacks</h3>
<br>
<p>Normally implemented by an activity or fragment</p>
<pre><code>public interface LoaderCallbacks&lt;D&gt; {
        public Loader&lt;D&gt; onCreateLoader(int id, Bundle args);

        public void onLoadFinished(Loader&lt;D&gt; loader, D data);
          
        public void onLoaderReset(Loader&lt;D&gt; loader);
}</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->
<h3>Extending AsyncTaskLoader</h3>
<pre><code>public class MyLoader extends AsyncTaskLoader&lt;String&gt;{
  private final Uri uri;

  public MyLoader(Context context, Uri uri) {
    super(context);
    this.uri = uri;
  }

  @Override
  public JsonNode loadInBackground() {
    return new HttpCall(uri).execute();
  }
  
  @Override
  protected void onStartLoading() {
    super.onStartLoading();
    forceLoad();
  }
}</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->
<h3>Activity and LoaderCallbacks</h3>
<pre><code>class MyActivity extends Activity implements LoaderCallbacks&lt;String&gt;{

  @Override
  protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    getLoaderManager().initLoader(0, null, this);
  }

  public Loader&lt;String&gt; onCreateLoader(int id, Bundle args) {
    return new MyLoader(this, uri);
  }

  public void onLoadFinished(Loader&lt;String&gt; loader, String data) {
    refresh(data);
  }

  public void onLoaderReset(Loader&lt;String&gt; loader) {
    removeData();
  }
...</code></pre>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->
<h3>Restarting a loader</h3>
<pre><code>getLoaderManager().restartLoader(0, null, this);</code></pre>
<p>Used when data needs to be reloaded - initLoader re-delivers data if it hasn't changed</p>

<!-- ==================================================== -->
</article><!-- slide separator--><article>
<!-- ==================================================== -->
<h3>Exercises</h3>
<ul>
  <li>Create a ListFragment and load data to the list using CursorLoader</li>
  <li>Create your own loader, for eg: to do an HttpCall or other long running task - even a Thread.sleep(..)</li>
  <li>While doing the above change orientation and see what happens with the data being loaded...</li>
</ul>


<!-- ==================================================== -->     
</article>
     
    </section>
  </body>
</html>
